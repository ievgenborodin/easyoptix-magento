/**
 * Easy Optix
 *
 * @author      Ievgen Borodin
 * @copyright   Copyright (c) 2016 EasyOptix Inc. (http://www.easy-optix.com)
 */

jQuery(document).ready(function(){function a(a,b){var c,d=b.length,e="",f=o[a],g=f.label,h=f.type,i=f.parent?f.parent+" ":"",j=f.child?f.child+" ":"",k="",l="";if("boolean"===h)e='<li><div class="sort-btn boolean" data-value="1" data-code="'+a+'"><span>'+g+'<i class="fa fa-check" aria-hidden="true"></i></span></div></li>';else if("color"===h){if(d<2)return"";for(k+="<ul>",c=0;c<d;c++)l='style="background-color:'+b[c]+";color:"+b[c]+'"',k+='<li><div class="sort-btn color" data-value="'+b[c]+'" data-code="'+a+'"'+l+'><i class="fa fa-check" aria-hidden="true"></i></div></li>';k+="</ul>",e='<li><div class="sort-block-title"><span>'+g+'<i class="fa fa-angle-down"></i></span></div><div class="sort-block '+a+' animated-hide"><div class="sort-block-opts">'+k+"</div></div></li>"}else{if(d<2)return"";for(k+="<ul>",c=0;c<d;c++)k+='<li><div class="sort-btn '+j+i+'" data-value="'+b[c]+'" data-code="'+a+'"><i class="fa fa-check" aria-hidden="true"></i>'+b[c]+"</div></li>";k+="</ul>",e='<li><div class="sort-block-title"><span>'+g+'<i class="fa fa-angle-down"></i></span></div><div class="sort-block '+a+' animated-hide"><div class="sort-block-opts">'+k+"</div></div></li>"}return e}function b(a){var b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=[],y=[],z={},A=0;if(b=jQuery("li.item"),g=jQuery(".sort-btn-active"),g.length){b.addClass("hide"),g.each(function(b,c){j=jQuery(this),n=j.data("code")+"",q=j.data("value")+"",z[n]||(z[n]=[]),a[n][q].forEach(function(a){z[n].indexOf(a)==-1&&z[n].push(a)})}),jQuery(".sort-btn.child").addClass("hide");for(m in z)c=jQuery(".sort-block."+m),c.hasClass("parent")?(o=c.data("child"),e=jQuery(".sort-block."+o),e.removeClass("animated-hide"),h=c.find(".sort-btn-active"),x=[],h.each(function(a,b){k=jQuery(this),x.push(k.data("value"))}),i=e.find(".sort-btn"),i.each(function(a,b){l=jQuery(this),r=l.data("parent"),x.indexOf(r)!=-1&&l.removeClass("hide")})):c.hasClass("child")&&(p=c.data("parent"),f=jQuery(".sort-block."+p),h=f.find(".sort-btn-active"),h.length||(c.find(".sort-btn.child").removeClass("sort-btn-active"),c.hasClass("animated-hide")||c.addClass("animated-hide"),delete z[m]));if(v=Object.keys(z),w=v.length,0==w)b.removeClass("hide");else if(1==w)y=z[v[0]];else for(t=z[v[0]],s=0,len=t.length;s<len;s++)u=t[s],d(y,z,v,u,A,s);y.each(function(a){b.eq(a).removeClass("hide")})}else b.removeClass("hide");jQuery(".sort-btn-active").length?jQuery("#filters-reset").css("display","block"):jQuery("#filters-reset").css("display","none"),jQuery("#item-counter").html(jQuery(".item").not(".hide").length)}function c(a){var b,c=jQuery(".active-filter");c.not(a).each(function(){b=jQuery(this),0==b.siblings().addClass("animated-hide").stop(!0,!0).slideUp(200).find(".sort-btn-active").length&&b.removeClass("active-filter")})}function d(a,b,c,e,f,g){var h;f+1<c.length?(h=b[c[f+1]],h.indexOf(e)!=-1&&(f++,d(a,b,c,e,f,g))):a.push(e)}function e(){var a=jQuery(".item").filter(function(a){return jQuery(this).position().top+C<D+jQuery(window).scrollTop()});a.find(".product-img.hid").each(function(a,b){var c=jQuery(this);c.attr("src",c.data("src")).removeClass("hid")}),a.find(".child-img.hid").each(function(a,b){var c=jQuery(this);c.attr("src",c.data("src")).removeClass("hid")})}function f(a){var b=jQuery(this).scrollTop(),c=a.css("max-height"),d=c.substr(0,c.length-2);newHeight=d-.5*b,newHeight>0?a.css("height",newHeight):a.css("height",0)}function g(){var a=jQuery(".category-image-wrap"),b=.2*a.width();a.css("height",b+"px").css("max-height",b+"px")}function h(){var a=jQuery(window).width();return a>1023?164:a>767?100:50+jQuery(".category-image-wrap").height()}var i,j,k,l,m=jQuery(".product-rows > li.item"),n={},o={eyewear_type:{label:"Type",type:"string",urlRule:/sunglasses|eyeglasses/i},prescription_ready:{label:"Prescription Ready",type:"boolean",urlRule:/prescription\-sunglasses|eyeglasses/i},department:{label:"Gender",type:"string",urlRule:/men|women|miu-miu/i},style:{label:"Shape",type:"string",urlRule:/style/i},brand:{label:"Brand",type:"string",urlRule:/brand/i},brand_model:{label:"Model",type:"string"},brand_ext:{label:"Ext",type:"string"},frame_material:{label:"Frame Material",type:"string"},lens_material:{label:"Lens Material",type:"string",urlRule:/eyeglasses/i},colors:{label:"Colors",type:"color"},polarized:{label:"Polarized",type:"boolean",urlRule:/eyeglasses/i},lens_width:{label:"Lens Width",type:"string"}};for(k in o)n[k]=[];jQuery.each(m,function(a,b){l=b.dataset.s.split("*"),a=0;for(k in n)n[k].push(l[a]),a++});var p=jQuery("document").context.URL;for(var q in o){var r,s=o[q].urlRule;s&&(r=!!p.match(s),r&&delete n[q])}delete n.brand_ext;var k,i,j,t,u,v,w,x,y="",z=n.frame_material.length;for(k in n){for(t=[],u=n[k],x=[],i=0;i<z;i++)if(v=u[i],w=v.split(","),w.length>1)for(j=0;j<w.length;j++)"r"!=w[j]&&(t.indexOf(w[j])===-1?(t.push(w[j]),x[w[j]]=[i]):x[w[j]].push(i));else"r"!=v&&(t.indexOf(v)===-1?(t.push(v),x[v]=[i]):x[v].push(i));n[k]=x,y+=a(k,t.sort())}jQuery(".fs-filters-ul").html(y),jQuery(".sort-btn").on("click",function(a){jQuery(this).toggleClass("sort-btn-active"),b(n),0!=jQuery(".product-img.hid").length&&e()}),jQuery(".sort-block-title").on("click",function(a){c(jQuery(this)),jQuery(this).addClass("active-filter").siblings().toggleClass("animated-hide").stop(!0,!0).slideToggle(200)}),jQuery("#filters-reset").on("click",function(a){jQuery(".sort-btn-active").removeClass("sort-btn-active"),c(jQuery(this)),b(n)}),jQuery("#filters-switch").on("click",function(a){var b=jQuery(this);b.toggleClass("active"),b.hasClass("active")?(jQuery(".fs-filters-reset").css("display","block"),jQuery(".fs-center").css("display","block")):(jQuery(".fs-filters-reset").css("display","none"),jQuery(".fs-center").css("display","none"))});var A,B=jQuery(window).height(),C=jQuery(".item").height(),D=B+C,E=jQuery(window),F=jQuery(".fs-wrap"),G=jQuery(".category-image-wrap");g(),A=h(),E.resize(function(){g(),A=h()}),e(),E.scrollTop()>A?F.addClass("fix"):F.removeClass("fix"),jQuery("#item-counter").html(jQuery(".item").not(".hide").length);var H=0;E.scroll(function(){var a=jQuery(this).scrollTop(),b=jQuery(".product-img.hid").length;console.log(a),G.length&&E.width()>767&&f(G),a>A?F.addClass("fix"):F.removeClass("fix"),a-H>150&&0!=b&&(H=a,e())});var I=new Image;jQuery(".child-img").hover(function(a){var b,c=jQuery(this);b=jQuery("#"+c.data("parent")),I.src=b.attr("src"),b.attr("src",c.attr("src")).addClass("slowFade")},function(a){var b,c=jQuery(this);b=jQuery("#"+c.data("parent")),b.attr("src",I.src).removeClass("slowFade")})});