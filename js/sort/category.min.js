/**
 * Easy Optix
 *
 * @author      Ievgen Borodin
 * @copyright   Copyright (c) 2016 EasyOptix Inc. (http://www.easy-optix.com)
 */

jQuery(document).ready(function(){function a(a,b){var c,d=b.length,e="",f=m[a],g=f.label,h=f.type,i=f.parent?f.parent+" ":"",j=f.child?f.child+" ":"",k="",l="";if("boolean"===h)e='<li><div class="sort-btn boolean" data-value="1" data-code="'+a+'"><span>'+g+'<i class="fa fa-check" aria-hidden="true"></i></span></div></li>';else if("color"===h){if(d<2)return"";for(k+="<ul>",c=0;c<d;c++)l='style="background-color:'+b[c]+";color:"+b[c]+'"',k+='<li><div class="sort-btn color" data-value="'+b[c]+'" data-code="'+a+'"'+l+'><i class="fa fa-check" aria-hidden="true"></i></div></li>';k+="</ul>",e='<li><div class="sort-block-title"><span>'+g+'<i class="fa fa-angle-down"></i></span></div><div class="sort-block '+a+' animated-hide"><div class="sort-block-opts">'+k+"</div></div></li>"}else{if(d<2)return"";for(k+="<ul>",c=0;c<d;c++)k+='<li><div class="sort-btn '+j+i+'" data-value="'+b[c]+'" data-code="'+a+'"><i class="fa fa-check" aria-hidden="true"></i>'+b[c]+"</div></li>";k+="</ul>",e='<li><div class="sort-block-title"><span>'+g+'<i class="fa fa-angle-down"></i></span></div><div class="sort-block '+a+' animated-hide"><div class="sort-block-opts">'+k+"</div></div></li>"}return e}function b(a){var b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=[],y=[],z={},A=0;if(b=jQuery("li.item"),g=jQuery(".sort-btn-active"),g.length){b.addClass("hide"),g.each(function(b,c){j=jQuery(this),n=j.data("code")+"",q=j.data("value")+"",z[n]||(z[n]=[]),a[n][q].forEach(function(a){z[n].indexOf(a)==-1&&z[n].push(a)})}),jQuery(".sort-btn.child").addClass("hide");for(m in z)c=jQuery(".sort-block."+m),c.hasClass("parent")?(o=c.data("child"),e=jQuery(".sort-block."+o),e.removeClass("animated-hide"),h=c.find(".sort-btn-active"),x=[],h.each(function(a,b){k=jQuery(this),x.push(k.data("value"))}),i=e.find(".sort-btn"),i.each(function(a,b){l=jQuery(this),r=l.data("parent"),x.indexOf(r)!=-1&&l.removeClass("hide")})):c.hasClass("child")&&(p=c.data("parent"),f=jQuery(".sort-block."+p),h=f.find(".sort-btn-active"),h.length||(c.find(".sort-btn.child").removeClass("sort-btn-active"),c.hasClass("animated-hide")||c.addClass("animated-hide"),delete z[m]));if(v=Object.keys(z),w=v.length,0==w)b.removeClass("hide");else if(1==w)y=z[v[0]];else for(t=z[v[0]],s=0,len=t.length;s<len;s++)u=t[s],d(y,z,v,u,A,s);y.each(function(a){b.eq(a).removeClass("hide")})}else b.removeClass("hide");jQuery(".sort-btn-active").length?jQuery("#filters-reset").css("display","block"):jQuery("#filters-reset").css("display","none"),jQuery("#item-counter").html(jQuery(".item").not(".hide").length)}function c(a){var b,c=jQuery(".active-filter");c.not(a).each(function(){b=jQuery(this),0==b.siblings().addClass("animated-hide").stop(!0,!0).slideUp(200).find(".sort-btn-active").length&&b.removeClass("active-filter")})}function d(a,b,c,e,f,g){var h;f+1<c.length?(h=b[c[f+1]],h.indexOf(e)!=-1&&(f++,d(a,b,c,e,f,g))):a.push(e)}function e(){var a=jQuery(".item").filter(function(a){return jQuery(this).position().top+A<B+jQuery(window).scrollTop()});a.find(".product-img.hid").each(function(a,b){var c=jQuery(this);c.attr("src",c.data("src")).removeClass("hid")}),a.find(".child-img.hid").each(function(a,b){var c=jQuery(this);c.attr("src",c.data("src")).removeClass("hid")})}function f(a){var b=jQuery(this).scrollTop(),c=a.css("max-height"),d=c.substr(0,c.length-2);newHeight=d-.5*b,newHeight>0?a.css("height",newHeight):a.css("height",0)}var g,h,i,j,k=jQuery(".product-rows > li.item"),l={},m={eyewear_type:{label:"Type",type:"string",urlRule:/sunglasses|eyeglasses/i},prescription_ready:{label:"Prescription Ready",type:"boolean",urlRule:/prescription\-sunglasses|eyeglasses/i},department:{label:"Gender",type:"string",urlRule:/men|women|miu-miu/i},style:{label:"Shape",type:"string",urlRule:/style/i},brand:{label:"Brand",type:"string",urlRule:/brand/i},brand_model:{label:"Model",type:"string"},brand_ext:{label:"Ext",type:"string"},frame_material:{label:"Frame Material",type:"string"},lens_material:{label:"Lens Material",type:"string",urlRule:/eyeglasses/i},colors:{label:"Colors",type:"color"},polarized:{label:"Polarized",type:"boolean",urlRule:/eyeglasses/i},lens_width:{label:"Lens Width",type:"string"}};for(i in m)l[i]=[];jQuery.each(k,function(a,b){j=b.dataset.s.split("*"),a=0;for(i in l)l[i].push(j[a]),a++});var n=jQuery("document").context.URL;for(var o in m){var p,q=m[o].urlRule;q&&(p=!!n.match(q),p&&delete l[o])}delete l.brand_ext;var i,g,h,r,s,t,u,v,w="",x=l.frame_material.length;for(i in l){for(r=[],s=l[i],v=[],g=0;g<x;g++)if(t=s[g],u=t.split(","),u.length>1)for(h=0;h<u.length;h++)"r"!=u[h]&&(r.indexOf(u[h])===-1?(r.push(u[h]),v[u[h]]=[g]):v[u[h]].push(g));else"r"!=t&&(r.indexOf(t)===-1?(r.push(t),v[t]=[g]):v[t].push(g));l[i]=v,w+=a(i,r.sort())}jQuery(".fs-filters-ul").html(w),jQuery(".sort-btn").on("click",function(a){jQuery(this).toggleClass("sort-btn-active"),b(l),0!=jQuery(".product-img.hid").length&&e()}),jQuery(".sort-block-title").on("click",function(a){c(jQuery(this)),jQuery(this).addClass("active-filter").siblings().toggleClass("animated-hide").stop(!0,!0).slideToggle(200)}),jQuery("#filters-reset").on("click",function(a){jQuery(".sort-btn-active").removeClass("sort-btn-active"),c(jQuery(this)),b(l)}),jQuery("#filters-switch").on("click",function(a){var b=jQuery(this);b.toggleClass("active"),b.hasClass("active")?(jQuery(".fs-filters-reset").css("display","block"),jQuery(".fs-center").css("display","block")):(jQuery(".fs-filters-reset").css("display","none"),jQuery(".fs-center").css("display","none"))});var y,z=jQuery(window).height(),A=jQuery(".item").height(),B=z+A,C=jQuery(window),D=jQuery(".fs-wrap");y=C.width()<1023?150:95,e(),C.scrollTop()>y?D.addClass("fix"):D.removeClass("fix"),jQuery("#item-counter").html(jQuery(".item").not(".hide").length);var E=0;C.scroll(function(){var a=jQuery(this).scrollTop(),b=jQuery(".product-img.hid").length,c=jQuery(".category-image-wrap");c.length&&C.width()>767&&f(c),a>y?D.addClass("fix"):D.removeClass("fix"),a-E>150&&0!=b&&(E=a,e(),console.log("executed"))});var F=new Image;jQuery(".child-img").hover(function(a){var b,c=jQuery(this);b=jQuery("#"+c.data("parent")),F.src=b.attr("src"),b.attr("src",c.attr("src")).addClass("slowFade")},function(a){var b,c=jQuery(this);b=jQuery("#"+c.data("parent")),b.attr("src",F.src).removeClass("slowFade")})});