/**
 * Easy Optix
 *
 * @author      Ievgen Borodin
 * @copyright   Copyright (c) 2016 EasyOptix Inc. (http://www.easy-optix.com)
 */

jQuery(document).ready(function(){function u(a,b){var c,e=b.length,f="",g=h[a],i=g.label,j=g.type,k=g.parent?g.parent+" ":"",l=g.child?g.child+" ":"",m="",n="";if("boolean"===j)f='<li><div class="sort-btn boolean" data-value="1" data-code="'+a+'"><span>'+i+'<i class="fa fa-check" aria-hidden="true"></i></span></div></li>';else if("color"===j){if(e<2)return"";for(m+="<ul>",c=0;c<e;c++)n='style="background-color:'+b[c]+";color:"+b[c]+'"',m+='<li><div class="sort-btn color" data-value="'+b[c]+'" data-code="'+a+'"'+n+'><i class="fa fa-check" aria-hidden="true"></i></div></li>';m+="</ul>",f='<li><div class="sort-block-title"><span>'+i+'<i class="fa fa-angle-down"></i></span></div><div class="sort-block '+a+' animated-hide"><div class="sort-block-opts">'+m+"</div></div></li>"}else{if(e<2)return"";for(m+="<ul>",c=0;c<e;c++)m+='<li><div class="sort-btn '+l+k+'" data-value="'+b[c]+'" data-code="'+a+'"><i class="fa fa-check" aria-hidden="true"></i>'+b[c]+"</div></li>";m+="</ul>",f='<li><div class="sort-block-title"><span>'+i+'<i class="fa fa-angle-down"></i></span></div><div class="sort-block '+a+' animated-hide"><div class="sort-block-opts">'+m+"</div></div></li>"}return f}function v(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,r,t,y,z,A,B,q=[],s=[],w={},C=0;if(b=jQuery("li.item"),f=jQuery(".sort-btn-active"),f.length){b.addClass("hide"),f.each(function(){i=jQuery(this),m=i.data("code")+"",p=i.data("value")+"",w[m]||(w[m]=[]),a[m][p].forEach(function(a){-1==w[m].indexOf(a)&&w[m].push(a)})}),jQuery(".sort-btn.child").addClass("hide");for(l in w)c=jQuery(".sort-block."+l),c.hasClass("parent")?(n=c.data("child"),d=jQuery(".sort-block."+n),d.removeClass("animated-hide"),g=c.find(".sort-btn-active"),q=[],g.each(function(){j=jQuery(this),q.push(j.data("value"))}),h=d.find(".sort-btn"),h.each(function(){k=jQuery(this),r=k.data("parent"),-1!=q.indexOf(r)&&k.removeClass("hide")})):c.hasClass("child")&&(o=c.data("parent"),e=jQuery(".sort-block."+o),g=e.find(".sort-btn-active"),g.length||(c.find(".sort-btn.child").removeClass("sort-btn-active"),c.hasClass("animated-hide")||c.addClass("animated-hide"),delete w[l]));if(A=Object.keys(w),B=A.length,0==B)b.removeClass("hide");else if(1==B)s=w[A[0]];else for(y=w[A[0]],t=0,len=y.length;t<len;t++)z=y[t],x(s,w,A,z,C,t);s.each(function(a){b.eq(a).removeClass("hide")})}else b.removeClass("hide");jQuery(".sort-btn-active").length?jQuery("#filters-reset").css("display","block"):jQuery("#filters-reset").css("display","none"),jQuery("#item-counter").html(jQuery(".item").not(".hide").length)}function w(a){var c,b=jQuery(".active-filter");b.not(a).each(function(){c=jQuery(this),0==c.siblings().addClass("animated-hide").stop(!0,!0).slideUp(200).find(".sort-btn-active").length&&c.removeClass("active-filter")})}function x(a,b,c,d,e,f){var g;e+1<c.length?(g=b[c[e+1]],-1!=g.indexOf(d)&&(e++,x(a,b,c,d,e,f))):a.push(d)}function B(){{var a=jQuery(".item").filter(function(){return jQuery(this).position().top+z<A+jQuery(window).scrollTop()});a.find(".product-img.hid").each(function(){var c=jQuery(this);c.attr("src",c.data("src")).removeClass("hid")}),a.find(".child-img.hid").each(function(){var c=jQuery(this);c.attr("src",c.data("src")).removeClass("hid")})}}var b,c,d,e,a=jQuery(".product-rows > li.item"),f={},h={eyewear_type:{label:"Type",type:"string",urlRule:/sunglasses|eyeglasses/i},prescription_ready:{label:"Prescription Ready",type:"boolean",urlRule:/prescription\-sunglasses|eyeglasses/i},department:{label:"Gender",type:"string",urlRule:/men|women|miu-miu/i},style:{label:"Shape",type:"string",urlRule:/style/i},brand:{label:"Brand",type:"string",urlRule:/brand/i},brand_model:{label:"Model",type:"string"},brand_ext:{label:"Ext",type:"string"},frame_material:{label:"Frame Material",type:"string"},lens_material:{label:"Lens Material",type:"string",urlRule:/eyeglasses/i},colors:{label:"Colors",type:"color"},polarized:{label:"Polarized",type:"boolean",urlRule:/eyeglasses/i},lens_width:{label:"Lens Width",type:"string"}};for(d in h)f[d]=[];jQuery.each(a,function(a,b){e=b.dataset.s.split("*"),a=0;for(d in f)f[d].push(e[a]),a++});var i=jQuery("document").context.URL;for(var j in h){var l,k=h[j].urlRule;k&&(l=i.match(k)?!0:!1,l&&delete f[j])}delete f.brand_ext;var d,b,c,m,n,o,p,r,q="",t=f.frame_material.length;for(d in f){for(m=[],n=f[d],r=[],b=0;b<t;b++)if(o=n[b],p=o.split(","),p.length>1)for(c=0;c<p.length;c++)"r"!=p[c]&&(-1===m.indexOf(p[c])?(m.push(p[c]),r[p[c]]=[b]):r[p[c]].push(b));else"r"!=o&&(-1===m.indexOf(o)?(m.push(o),r[o]=[b]):r[o].push(b));f[d]=r,q+=u(d,m.sort())}jQuery(".fs-filters-ul").html(q),jQuery(".sort-btn").on("click",function(){jQuery(this).toggleClass("sort-btn-active"),v(f),0!=jQuery(".product-img.hid").length&&B()}),jQuery(".sort-block-title").on("click",function(){w(jQuery(this)),jQuery(this).addClass("active-filter").siblings().toggleClass("animated-hide").stop(!0,!0).slideToggle(200)}),jQuery("#filters-reset").on("click",function(){jQuery(".sort-btn-active").removeClass("sort-btn-active"),w(jQuery(this)),v(f)}),jQuery("#filters-switch").on("click",function(){var b=jQuery(this);b.toggleClass("active"),b.hasClass("active")?(jQuery(".fs-filters-reset").css("display","block"),jQuery(".fs-center").css("display","block")):(jQuery(".fs-filters-reset").css("display","none"),jQuery(".fs-center").css("display","none"))});var y=jQuery(window).height(),z=jQuery(".item").height(),A=y+z,C=jQuery(window),D=jQuery(".fs-wrap");B(),C.scrollTop()>155?D.addClass("fix"):D.removeClass("fix"),jQuery("#item-counter").html(jQuery(".item").not(".hide").length);var E=0;C.scroll(function(){var a=jQuery(this).scrollTop(),b=jQuery(".product-img.hid").length;a>155?D.addClass("fix"):D.removeClass("fix"),a-E>150&&0!=b&&(E=a,B())});var F=new Image;jQuery(".child-img").hover(function(){var c,b=jQuery(this);c=jQuery("#"+b.data("parent")),F.src=c.attr("src"),c.attr("src",b.attr("src")).addClass("slowFade")},function(){var c,b=jQuery(this);c=jQuery("#"+b.data("parent")),c.attr("src",F.src).removeClass("slowFade")})});