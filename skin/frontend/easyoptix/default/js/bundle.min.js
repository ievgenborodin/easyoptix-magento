/**
 * Easy Optix
 *
 * @author      Ievgen Borodin
 * @copyright   Copyright (c) 2016 EasyOptix Inc. (http://www.easy-optix.com)
 */

if("undefined"==typeof Product)var Product={};Product.Bundle=Class.create(),Product.Bundle.prototype={initialize:function(a){if(this.config=a,a.defaultValues)for(var b in a.defaultValues)if(this.config.options[b].isMulti){for(var c=new Array,d=0;d<a.defaultValues[b].length;d++)c.push(a.defaultValues[b][d]);this.config.selected[b]=c}else this.config.selected[b]=new Array(a.defaultValues[b]+"");this.reloadPrice()},changeSelection:function(a,b){var c=a.split("-"),d=b+"";""!=d?this.config.selected[c[2]]=new Array(d):this.config.selected[c[2]]=new Array,this.populateQty(c[2],d);var e=$("bundle-option-"+c[2]+"-tier-prices"),f="";""!=d&&1==this.config.options[c[2]].selections[d].customQty&&(f=this.config.options[c[2]].selections[d].tierPriceHtml),e.update(f),this.reloadPrice()},reloadPrice:function(){var a=0,b=0,c=0;for(var d in this.config.selected)if(this.config.options[d])for(var e=0;e<this.config.selected[d].length;e++){var f=this.selectionPrice(d,this.config.selected[d][e]);a+=Number(f[0]),b+=Number(f[1]),c+=Number(f[2])}if(taxCalcMethod==CACL_TOTAL_BASE){var g=a.toFixed(10),h=c.toFixed(10),i=h-g;a=c-Math.round(100*i)/100}"0"==this.config.priceType&&(a=Math.round(100*a)/100,b=Math.round(100*b)/100,c=Math.round(100*c)/100);var j=$(document).fire("bundle:reload-price",{price:a,priceInclTax:c,dispositionPrice:b,bundle:this});return j.noReloadPrice||(optionsPrice.specialTaxPrice="true",optionsPrice.changePrice("bundle",a),optionsPrice.changePrice("nontaxable",b),optionsPrice.changePrice("priceInclTax",c),optionsPrice.reload()),a},selectionPrice:function(a,b){if(""==b||"none"==b)return 0;var c,d,e=null;if(e=1!=this.config.options[a].selections[b].customQty||this.config.options[a].isMulti?this.config.options[a].selections[b].qty:$("bundle-option-"+a+"-qty-input")?$("bundle-option-"+a+"-qty-input").value:1,"0"==this.config.priceType){price=this.config.options[a].selections[b].price,tierPrice=this.config.options[a].selections[b].tierPrice;for(var f=0;f<tierPrice.length;f++)Number(tierPrice[f].price_qty)<=e&&Number(tierPrice[f].price)<=price&&(price=tierPrice[f].price,c=tierPrice[f].priceInclTax,d=tierPrice[f].priceExclTax)}else selection=this.config.options[a].selections[b],"0"==selection.priceType?price=selection.priceValue:price=this.config.basePrice*selection.priceValue/100;var g=this.config.options[a].selections[b].plusDisposition+this.config.options[a].selections[b].minusDisposition;if(this.config.specialPrice&&(newPrice=price*this.config.specialPrice/100,price=Math.min(newPrice,price)),selection=this.config.options[a].selections[b],void 0!==c&&void 0!==d?(priceInclTax=c,price=d):void 0!==selection.priceInclTax?(priceInclTax=selection.priceInclTax,price=void 0!==selection.priceExclTax?selection.priceExclTax:selection.price):priceInclTax=price,"1"==this.config.priceType||taxCalcMethod==CACL_TOTAL_BASE){var h=new Array(price*e,g*e,priceInclTax*e);return h}if(taxCalcMethod==CACL_UNIT_BASE){price=(Math.round(100*price)/100).toString(),g=(Math.round(100*g)/100).toString(),priceInclTax=(Math.round(100*priceInclTax)/100).toString();var h=new Array(price*e,g*e,priceInclTax*e);return h}price=(Math.round(price*e*100)/100).toString(),g=(Math.round(g*e*100)/100).toString(),priceInclTax=(Math.round(priceInclTax*e*100)/100).toString();var h=new Array(price,g,priceInclTax);return h},populateQty:function(a,b){return""==b||"none"==b?void this.showQtyInput(a,"0",!1):void(1==this.config.options[a].selections[b].customQty?this.showQtyInput(a,this.config.options[a].selections[b].qty,!0):this.showQtyInput(a,this.config.options[a].selections[b].qty,!1))},showQtyInput:function(a,b,c){elem=$("bundle-option-"+a+"-qty-input"),elem.value=b,elem.disabled=!c,c?elem.removeClassName("qty-disabled"):elem.addClassName("qty-disabled")},changeOptionQty:function(a,b){var c=!0;"undefined"!=typeof b&&(8!=b.keyCode&&46!=b.keyCode||(c=!1)),c&&(0==Number(a.value)||isNaN(Number(a.value)))&&(a.value=1),parts=a.id.split("-"),optionId=parts[2],this.config.options[optionId].isMulti||(selectionId=this.config.selected[optionId][0],this.config.options[optionId].selections[selectionId].qty=1*a.value,this.reloadPrice())},validationCallback:function(a,b){if(void 0!=a&&void 0!=$(a)){var c=$(a).up("ul.options-list");"undefined"!=typeof c&&("failed"==b?(c.removeClassName("validation-passed"),c.addClassName("validation-failed")):(c.removeClassName("validation-failed"),c.addClassName("validation-passed")))}}},jQuery(document).ready(function(){function a(a){var b=jQuery(window),c=b.scrollTop(),d=a.getBoundingClientRect().top,e=b.width(),f=e<1024?jQuery(".top-icon-menu").innerHeight():jQuery(".header-wrap").innerHeight(),g=c+d-f;jQuery("body,html").stop(!1,!1).animate({scrollTop:g},1e3)}function b(){var b,d=jQuery(".bundle-option-button.lenstype-col.lens-marked"),e=jQuery(".bundle-option-button.lensmaterial-col.lens-marked"),f=jQuery(".lenstransition-block");if(d.length){var g=jQuery(".lensmaterial-block");if(g.hasClass("show-iblock")||(g.addClass("show-iblock").append(c),a(c)),e.length){var h=jQuery(".lensanti-reflection-block");h.hasClass("show-iblock")||(h.addClass("show-iblock").append(c),a(c)),2!=d.eq(0).data("index")?f.addClass("show-iblock"):(f.removeClass("show-iblock"),b=f.find(".bundle-option-button").removeClass("lens-marked").eq(0).addClass("lens-marked").data("id"),bundle.changeSelection(b,"")),jQuery(".product-options-bottom").addClass("show-iblock")}}}jQuery(".dark-wrapper").appendTo(jQuery("body")),jQuery(".lenstype-desc").html("Choose the lens type"),jQuery(".lensmaterial-desc").html("Choose the material for your lens"),jQuery(".lensanti-reflection-desc").html("Add anti-reflaction to lens"),jQuery(".lenstransition-desc").html("Add transition or polarization to lens");var c=document.getElementById("step-marker");a(c),jQuery(".bundle-option-button").on("click",function(a){var c=jQuery(this),d=c.data("value"),e=c.data("id");c.siblings(".bundle-option-button").removeClass("lens-marked"),c.addClass("lens-marked"),jQuery("#"+e).val(d),bundle.changeSelection(e,d),b()}),jQuery(".terms-agree").on("click",function(b){var d=jQuery(this);d.hasClass("lens-button-on")||d.addClass("lens-button-on");var e=jQuery(".lenstype-block");e.hasClass("show-iblock")||(e.addClass("show-iblock").append(c),a(c))}),jQuery(".compare").on("click",function(a){var b,c=jQuery(this).data("infoname");jQuery(".imagination > img").css("display","none"),b=jQuery(".imagination > ."+c),b.attr("src",b.data("src")).css("display","block"),jQuery(".dark-wrapper").css("display","block").css("height",jQuery(document).height()+"px")}),jQuery(".dark-wrapper").on("click",function(a){jQuery(this).css("display","none")})});