window.Catalog||(window.Catalog={}),Catalog.Map={helpLinks:[],active:!1,addHelpLink:function(t,o,e,i,a){if("string"==typeof t&&(t=$$(t)[0]),t){var r={link:t},p=!1;if("string"==typeof o&&o&&(r.title=o,p=!0),("string"==typeof e&&e||"object"==typeof e&&e)&&(r.price=e,p=!0),"string"==typeof i&&i&&(r.msrp=i,p=!0),"string"==typeof a&&a?r.cartLink=a:a&&a.url&&(r.cartLink=a.url,a.qty&&(r.qty=a.qty),a.notUseForm&&(r.notUseForm=a.notUseForm)),p){var d=this.helpLinks.push(r)-1;Event.observe(t,"click",this.showHelp.bind(this.helpLinks[d]))}else this.setGotoView(t,a);return r}},setGotoView:function(t,o){$(t).stopObserving("click"),t.href=o,window.opener?Event.observe(t,"click",function(t){setPLocation(this.href,!0),Catalog.Map.hideHelp(),t.stop()}):Event.observe(t,"click",function(t){setLocation(this.href),Catalog.Map.hideHelp(),window.opener.focus(),t.stop()})},showSelects:function(){var t=document.getElementsByTagName("select");for(i=0;i<t.length;i++)t[i].style.visibility="visible"},hideSelects:function(){var t=document.getElementsByTagName("select");for(i=0;i<t.length;i++)t[i].style.visibility="hidden"},showHelp:function(t){var o=$("map-popup"),e="undefined"==typeof document.body.style.maxHeight;if(o){var i=$$("body")[0];if(o.parentNode!=i){o.remove(),i.insert(o);var a=o.select(".paypal-logo > a > img")[0];a&&(a.src=a.src)}if(this!=Catalog.Map&&Catalog.Map.active!=this.link){o.style.display="none",o.offsetPosition||(o.offsetPosition={left:0,top:0}),o.removeClassName("map-popup-right"),o.removeClassName("map-popup-left"),Element.getWidth(i)<t.pageX+Element.getWidth(o)?o.addClassName("map-popup-left"):t.pageX-Element.getWidth(o)<0&&o.addClassName("map-popup-right"),o.style.left=t.pageX-Element.getWidth(o)/2-45+"px",o.style.top=t.pageY+10+"px";var r=$("map-popup-heading");"undefined"!=typeof this.title?(Element.update(r,this.title),$(r).show()):$(r).hide();var p=$("map-popup-msrp-box");"undefined"!=typeof this.msrp?(Element.update($("map-popup-msrp"),this.msrp),$(p).show()):$(p).hide();var d=$("map-popup-price-box");if("undefined"!=typeof this.price){var n="object"==typeof this.price?this.price.innerHTML:this.price;Element.update($("map-popup-price"),n),$(d).show()}else $(d).hide();var s=$("map-popup-button");if("undefined"!=typeof this.cartLink){"undefined"==typeof productAddToCartForm||this.notUseForm?(Catalog.Map.setGotoView(s,this.cartLink),productAddToCartForm=$("product_addtocart_form_from_popup")):(this.qty&&(productAddToCartForm.qty=this.qty),s.stopObserving("click"),s.href=this.cartLink,Event.observe(s,"click",function(t){productAddToCartForm.action=this.href,productAddToCartForm.submit(this)})),productAddToCartForm.action=this.cartLink;var c=$("map-popup-product-id");c.value=this.product_id,$(s).show(),$$(".additional-addtocart-box").invoke("show")}else $(s).hide(),$$(".additional-addtocart-box").invoke("hide");var l=$("map-popup-text"),u=$("map-popup-text-what-this"),m=$("map-popup-content");p.visible()||d.visible()||s.visible()?($(u).hide(),$(l).show(),$(l).addClassName("map-popup-only-text"),$(m).show().setStyle({visibility:"visible"}),$("product_addtocart_form_from_popup").show()):($(l).hide(),$(u).show(),$(u).removeClassName("map-popup-only-text"),$(m).hide().setStyle({visibility:"hidden"}),$("product_addtocart_form_from_popup").hide()),$(o).show(),e&&Catalog.Map.hideSelects();var f=$("map-popup-close");f&&($(f).stopObserving("click"),Event.observe(f,"click",Catalog.Map.showHelp.bind(this)),Catalog.Map.active=this.link)}else $(o).hide(),e&&Catalog.Map.showSelects(),Catalog.Map.active=!1;Event.stop(t)}},hideHelp:function(){var t=$("map-popup");if(t){var o="undefined"==typeof document.body.style.maxHeight;$(t).hide(),o&&Catalog.Map.showSelects(),Catalog.Map.active=!1}},bindProductForm:function(){if("undefined"!=typeof productAddToCartForm&&productAddToCartForm)productAddToCartFormOld=productAddToCartForm,productAddToCartForm=new VarienForm("product_addtocart_form_from_popup"),productAddToCartForm.submitLight=productAddToCartFormOld.submitLight;else{if(!$("product_addtocart_form_from_popup"))return!1;"undefined"==typeof productAddToCartForm&&(productAddToCartForm=new VarienForm("product_addtocart_form_from_popup"))}productAddToCartForm.submit=function(t,o){if("undefined"!=typeof productAddToCartFormOld&&productAddToCartFormOld)return Catalog.Map.active&&Catalog.Map.hideHelp(),productAddToCartForm.qty&&$("qty")&&($("qty").value=productAddToCartForm.qty),parentResult=productAddToCartFormOld.submit(),!1;if(window.opener){var e=t;return void new Ajax.Request(this.form.action,{parameters:{isAjax:1,method:"GET"},onSuccess:function(t){window.opener.focus(),e&&e.href&&(setPLocation(e.href,!0),Catalog.Map.hideHelp())}})}if(this.validator.validate()){var i=this.form,a=i.action;o&&(i.action=o),i.getAttribute("action")||(i.action=productAddToCartForm.action);try{this.form.submit()}catch(r){throw this.form.action=a,r}this.form.action=a,t&&"undefined"!=t&&(t.disabled=!0)}}.bind(productAddToCartForm)}},Event.observe(window,"resize",function(t){Catalog.Map.active&&Catalog.Map.showHelp(t)}),$(document).observe("bundle:reload-price",function(t){var o=t.memo,e=o.bundle;if(!Number(e.config.isMAPAppliedDirectly)&&!Number(e.config.isFixedPrice)){var i=!1;try{for(var a in e.config.selected){if(e.config.options[a]&&e.config.options[a].selections)for(var r=e.config.options[a].selections,p=0,d=e.config.selected[a].length;d>p;p++){var n=e.config.selected[a][p];if(Number(r[n].canApplyMAP)){i=!0;break}}if(i)break}}catch(s){i=!0}i?($$(".full-product-price").each(function(t){$(t).hide()}),$$(".map-info").each(function(t){$(t).show()}),t.noReloadPrice=!0):($$(".full-product-price").each(function(t){$(t).show()}),$$(".map-info").each(function(t){$(t).hide()}))}});