if("undefined"==typeof Product)var Product={};Product.Bundle=Class.create(),Product.Bundle.prototype={initialize:function(e){if(this.config=e,e.defaultValues)for(var i in e.defaultValues)if(this.config.options[i].isMulti){for(var t=new Array,n=0;n<e.defaultValues[i].length;n++)t.push(e.defaultValues[i][n]);this.config.selected[i]=t}else this.config.selected[i]=new Array(e.defaultValues[i]+"");this.reloadPrice()},changeSelection:function(e,i){var t=e.split("-"),n=i+"";""!=n?this.config.selected[t[2]]=new Array(n):this.config.selected[t[2]]=new Array,this.populateQty(t[2],n);var o=$("bundle-option-"+t[2]+"-tier-prices"),s="";""!=n&&1==this.config.options[t[2]].selections[n].customQty&&(s=this.config.options[t[2]].selections[n].tierPriceHtml),o.update(s),this.reloadPrice()},reloadPrice:function(){var e=0,i=0,t=0;for(var n in this.config.selected)if(this.config.options[n])for(var o=0;o<this.config.selected[n].length;o++){var s=this.selectionPrice(n,this.config.selected[n][o]);e+=Number(s[0]),i+=Number(s[1]),t+=Number(s[2])}if(taxCalcMethod==CACL_TOTAL_BASE){var r=e.toFixed(10),c=t.toFixed(10),a=c-r;e=t-Math.round(100*a)/100}"0"==this.config.priceType&&(e=Math.round(100*e)/100,i=Math.round(100*i)/100,t=Math.round(100*t)/100);var l=$(document).fire("bundle:reload-price",{price:e,priceInclTax:t,dispositionPrice:i,bundle:this});return l.noReloadPrice||(optionsPrice.specialTaxPrice="true",optionsPrice.changePrice("bundle",e),optionsPrice.changePrice("nontaxable",i),optionsPrice.changePrice("priceInclTax",t),optionsPrice.reload()),e},selectionPrice:function(e,i){if(""==i||"none"==i)return 0;var t,n,o=null;if(o=1!=this.config.options[e].selections[i].customQty||this.config.options[e].isMulti?this.config.options[e].selections[i].qty:$("bundle-option-"+e+"-qty-input")?$("bundle-option-"+e+"-qty-input").value:1,"0"==this.config.priceType){price=this.config.options[e].selections[i].price,tierPrice=this.config.options[e].selections[i].tierPrice;for(var s=0;s<tierPrice.length;s++)Number(tierPrice[s].price_qty)<=o&&Number(tierPrice[s].price)<=price&&(price=tierPrice[s].price,t=tierPrice[s].priceInclTax,n=tierPrice[s].priceExclTax)}else selection=this.config.options[e].selections[i],"0"==selection.priceType?price=selection.priceValue:price=this.config.basePrice*selection.priceValue/100;var r=this.config.options[e].selections[i].plusDisposition+this.config.options[e].selections[i].minusDisposition;if(this.config.specialPrice&&(newPrice=price*this.config.specialPrice/100,price=Math.min(newPrice,price)),selection=this.config.options[e].selections[i],void 0!==t&&void 0!==n?(priceInclTax=t,price=n):void 0!==selection.priceInclTax?(priceInclTax=selection.priceInclTax,price=void 0!==selection.priceExclTax?selection.priceExclTax:selection.price):priceInclTax=price,"1"==this.config.priceType||taxCalcMethod==CACL_TOTAL_BASE){var c=new Array(price*o,r*o,priceInclTax*o);return c}if(taxCalcMethod==CACL_UNIT_BASE){price=(Math.round(100*price)/100).toString(),r=(Math.round(100*r)/100).toString(),priceInclTax=(Math.round(100*priceInclTax)/100).toString();var c=new Array(price*o,r*o,priceInclTax*o);return c}price=(Math.round(price*o*100)/100).toString(),r=(Math.round(r*o*100)/100).toString(),priceInclTax=(Math.round(priceInclTax*o*100)/100).toString();var c=new Array(price,r,priceInclTax);return c},populateQty:function(e,i){return""==i||"none"==i?void this.showQtyInput(e,"0",!1):void(1==this.config.options[e].selections[i].customQty?this.showQtyInput(e,this.config.options[e].selections[i].qty,!0):this.showQtyInput(e,this.config.options[e].selections[i].qty,!1))},showQtyInput:function(e,i,t){elem=$("bundle-option-"+e+"-qty-input"),elem.value=i,elem.disabled=!t,t?elem.removeClassName("qty-disabled"):elem.addClassName("qty-disabled")},changeOptionQty:function(e,i){var t=!0;"undefined"!=typeof i&&(8==i.keyCode||46==i.keyCode)&&(t=!1),t&&(0==Number(e.value)||isNaN(Number(e.value)))&&(e.value=1),parts=e.id.split("-"),optionId=parts[2],this.config.options[optionId].isMulti||(selectionId=this.config.selected[optionId][0],this.config.options[optionId].selections[selectionId].qty=1*e.value,this.reloadPrice())},validationCallback:function(e,i){if(void 0!=e&&void 0!=$(e)){var t=$(e).up("ul.options-list");"undefined"!=typeof t&&("failed"==i?(t.removeClassName("validation-passed"),t.addClassName("validation-failed")):(t.removeClassName("validation-failed"),t.addClassName("validation-passed")))}}},jQuery(document).ready(function(){function e(){var e,i=jQuery(".bundle-option-button.lenstype-col.lens-marked"),t=jQuery(".bundle-option-button.lensmaterial-col.lens-marked"),n=jQuery(".lenstransition-block");i.length&&(jQuery(".lensmaterial-block").addClass("show-iblock"),t.length&&(jQuery(".lensanti-reflection-block").addClass("show-iblock"),2!=i.eq(0).data("index")?n.addClass("show-iblock"):(n.removeClass("show-iblock"),e=n.find(".bundle-option-button").removeClass("lens-marked").eq(0).addClass("lens-marked").data("id"),bundle.changeSelection(e,"")),jQuery(".product-options-bottom").addClass("show-iblock")))}jQuery(".dark-wrapper").appendTo(jQuery("body")),jQuery(".lenstype-desc").html("Choose the lens type"),jQuery(".lensmaterial-desc").html("Choose the material for your lens"),jQuery(".lensanti-reflection-desc").html("Add anti-reflaction to lens"),jQuery(".lenstransition-desc").html("Add transition or polarization to lens"),jQuery(".bundle-option-button").on("click",function(i){var t=jQuery(this),n=t.data("value"),o=t.data("id");t.siblings(".bundle-option-button").removeClass("lens-marked"),t.addClass("lens-marked"),jQuery("#"+o).val(n),bundle.changeSelection(o,n),e()}),jQuery(".terms-agree").on("click",function(e){var i=jQuery(this);i.hasClass("lens-button-on")||i.addClass("lens-button-on"),jQuery(".lenstype-block").addClass("show-iblock")}),jQuery(".compare").on("click",function(e){var i,t=jQuery(this).data("infoname");jQuery(".imagination > img").css("display","none"),i=jQuery(".imagination > ."+t),i.attr("src",i.data("src")).css("display","block"),jQuery(".dark-wrapper").css("display","block").css("height",jQuery(document).height()+"px")}),jQuery(".dark-wrapper").on("click",function(e){jQuery(this).css("display","none")})});